{% extends 'base.html' %}

{% block body %}
<form action="{{ url_for("user.update", uid=user.uid) }}" method="POST">
<div class="align-self-center">
	<div class="float-sm-right pb-2">
		<button type="submit" class="btn btn-primary"><i class="fa fa-save" aria-hidden="true"></i> Save</button>
		<a href="{{ url_for("user.index") }}" class="btn btn-secondary">Cancel</a>
		{% if user.uid %}
			<a href="{{ url_for("mfa.admin_disable", uid=user.uid) }}" class="btn btn-secondary">Reset 2FA</a>
			<a href="{{ url_for("user.delete", uid=user.uid) }}" onClick="return confirm('Are you sure?');" class="btn btn-danger"><i class="fa fa-trash" aria-hidden="true"></i> Delete</a>
		{% else %}
			<a href="#" class="btn btn-danger disabled"><i class="fa fa-trash" aria-hidden="true"></i> Delete</a>
		{% endif %}
	</div>
	<ul class="nav nav-tabs pt-2 border-0" id="tablist" role="tablist">
		<li class="nav-item">
			<a class="nav-link active" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="true">Profile</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" id="roles-tab" data-toggle="tab" href="#roles" role="tab" aria-controls="roles" aria-selected="false">Roles</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" id="ldif-tab" data-toggle="tab" href="#ldif" role="tab" aria-controls="ldif" aria-selected="false">LDIF</a>
		</li>
	</ul>
	<div class="tab-content border mb-2 pt-2" id="tabcontent">
		<div class="tab-pane fade show active" id="profile" role="tabpanel" aria-labelledby="roles-tab">
			<div class="form-group col">
				<label for="user-uid">uid</label>
				{% if user.uid %}
				<input type="number" class="form-control" id="user-uid" name="uid" value="{{ user.uid }}" readonly>
				{% else %}
				<input type="text" class="form-control" id="user-uid" name="uid" placeholder="will be choosen" readonly>
				{% endif %}
			</div>
			<div class="form-group col">
				<label for="user-loginname">Login Name</label>
				<input type="text" class="form-control" id="user-loginname" name="loginname" value="{{ user.loginname }}" {% if user.uid %}readonly{% endif %}>
				<small class="form-text text-muted">
					Only letters, numbers and underscore ("_") are allowed. At most 32, at least 2 characters. There is a word blacklist. Musst be unique.
				</small>
			</div>
			<div class="form-group col">
				<label for="user-loginname">Display Name</label>
				<input type="text" class="form-control" id="user-displayname" name="displayname" value="{{ user.displayname }}">
				<small class="form-text text-muted">
					If you leave this empty it will be set to the login name. At most 128, at least 2 characters. No character restrictions.
				</small>
			</div>
			<div class="form-group col">
				<label for="user-mail">Mail</label>
				<input type="email" class="form-control" id="user-mail" name="mail" value="{{ user.mail }}">
				<small class="form-text text-muted">
					Do a sanity check here. A user can take over another account if both have the same mail address set.
				</small>
			</div>
			<div class="form-group col">
				<label for="user-loginname">Password</label>
				{% if user.uid %}
				<input type="password" class="form-control" id="user-password" name="password" placeholder="●●●●●●●●">
				{% else %}
				<input type="password" class="form-control" id="user-password" name="password" placeholder="mail to set it will be sent" readonly>
				{% endif %}
				<small class="form-text text-muted">
					At least 8 and at most 256 characters, no other special requirements. But please don't be stupid, do use a password manager.
				</small>
			</div>
		</div>
		<div class="tab-pane fade" id="roles" role="tabpanel" aria-labelledby="roles-tab">
			<div class="form-group col">
				<span>Roles:</span>
				<table class="table table-striped table-sm">
					<thead>
						<tr>
							<th scope="col"></th>
							<th scope="col">name</th>
							<th scope="col">description</th>
						</tr>
					</thead>
					<tbody>
						{% for role in roles|sort(attribute="name") %}
						<tr id="role-{{ role.id }}">
							<td>
								<div class="form-check">
									<input class="form-check-input" type="checkbox" id="role-{{ role.id }}-checkbox" name="role-{{ role.id }}" value="1" aria-label="enabled"
										{% if user.dn in role.member_dns() or role.name in config["ROLES_BASEROLES"] %}checked {% endif %}
										{% if role.name in config["ROLES_BASEROLES"] %}disabled {% endif %}>
								</div>
							</td>
							<td>
								<a href="{{ url_for("role.show", roleid=role.id) }}">
									{{ role.name }}
								</a>
							</td>
							<td>
								{{ role.description }}
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			<div class="form-group col">
				<span>Resulting groups (only updated after save):</span>
				<table class="table table-striped table-sm">
					<thead>
						<tr>
							<th scope="col">name</th>
							<th scope="col">description</th>
						</tr>
					</thead>
					<tbody>
						{% for group in user.groups|sort(attribute="name") %}
						<tr id="group-{{ group.gid }}">
							<td>
								<a href="{{ url_for("group.show", gid=group.gid) }}">
									{{ group.name }}
								</a>
							</td>
							<td>
								{{ group.description }}
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
		<div class="tab-pane fade" id="ldif" role="tabpanel" aria-labelledby="ldif-tab">
			<div class="form-group col">
				<pre>{{ user.ldif }}</pre>
			</div>
		</div>
	</div>
</div>
</form>
{% endblock %}
