{% extends 'base.html' %}

{% block body %}

{% if not user.mfa_enabled and user.compute_groups() != user.compute_groups(ignore_mfa=True) %}
<div class="alert alert-warning" role="alert">
	{{_("Some permissions require you to setup two-factor authentication.
	These permissions are not in effect until you do that.")}}
</div>
{% endif %}

<div class="btn-toolbar">
	<a class="ml-auto mb-3 btn btn-primary" href="{{ url_for('mfa.setup') }}">{{_("Manage two-factor authentication")}}</a>
</div>

<form action="{{ url_for("selfservice.update") }}" method="POST" onInput="
	password2.setCustomValidity(password1.value != password2.value ? 'Passwords do not match.' : '');
	password1.setCustomValidity((password1.value.length < 8 && password1.value.length > 0) ? 'Password is too short' : '') ">
<div class="align-self-center row">
	<div class="form-group col-md-6">
		<label for="user-uid">{{_("Uid")}}</label>
		<input type="number" class="form-control" id="user-uid" name="uid" value="{{ user.uid }}" readonly>
	</div>
	<div class="form-group col-md-6">
		<label for="user-loginname">{{_("Login Name")}}</label>
		<input type="text" class="form-control" id="user-loginname" name="loginname" value="{{ user.loginname }}" readonly>
	</div>
	<div class="form-group col-md-6">
		<label for="user-displayname">{{_("Display Name")}}</label>
		<input type="text" class="form-control" id="user-displayname" name="displayname" value="{{ user.displayname }}">
	</div>
	<div class="form-group col-md-6">
		<label for="user-mail">{{_("Mail")}}</label>
		<input type="email" class="form-control" id="user-mail" name="mail" value="{{ user.mail }}">
		<small class="form-text text-muted">
			{{_("We will send you a confirmation mail to set a new mail address.")}}
		</small>
	</div>
	<div class="form-group col-md-6">
		<label for="user-password1">{{_("Password")}}</label>
		<input type="password" class="form-control" id="user-password1" name="password1" placeholder="●●●●●●●●">
		<small class="form-text text-muted">
			{{_("At least 8 and at most 256 characters, no other special requirements. But please don't be stupid, do use a password manager.")}}
		</small>
	</div>
	<div class="form-group col-md-6">
		<label for="user-password2">{{_("Password Repeat")}}</label>
		<input type="password" class="form-control" id="user-password2" name="password2" placeholder="●●●●●●●●">
	</div>
	<div class="form-group">
		{% if user.roles|length %}
			{% if user.roles|length == 1 %}
				{{_("You have this role")}}:
			{% else %}
				{{_("You currently have these roles")}}:
			{% endif %}
			<ul>
				{% for role in user.roles|sort(attribute="name") %}
				<li>{{ role.name }}</li>
				{% endfor %}
			</ul>
		{% else %}
			{{_("You currently don't have any roles.")}}
		{% endif %}
	</div>
	<div class="form-group col-md-12">
		<button type="submit" class="btn btn-primary float-right"><i class="fa fa-save" aria-hidden="true"></i> {{_("Save")}}</button>
	</div>
</div>
</form>
{% endblock %}
